<!DOCTYPE html>
<html lang="es" data-theme="dark">
<head>
    <meta charset="UTF-8" />
    <title>Cargando... - Classroom</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="stylesheet" href="./assets/css/home-style.css">
    
    <style>
        /* Layout (de tu 'class.html') */
        .page-header {
            margin-bottom: 10px;
        }
        .page-title-class {
            margin: 0 0 4px;
            font-size: 2rem; /* 32px */
            font-weight: 700;
        }
        .page-subtitle-class {
            margin: 0;
            font-size: 1rem;
            color: var(--text-color-muted);
        }
        .badge-code {
            padding: 8px 18px;
            border-radius: 999px;
            background-color: var(--input-bg);
            color: var(--text-color);
            border: 1px solid var(--border);
            font-weight: 500;
            font-size: 14px;
            float: right; /* Alineado a la derecha */
        }
        
        /* Tabs (de tu 'class.html') */
        .tabs {
            display: inline-flex;
            gap: 0;
            border-radius: 10px;
            background-color: var(--input-bg);
            border: 1px solid var(--border);
            padding: 4px;
        }
        .tab-btn {
            border: none;
            padding: 9px 26px;
            border-radius: 8px;
            background: transparent;
            cursor: pointer;
            font-size: 14px;
            color: var(--text-color-muted);
            display: inline-flex;
            align-items: center;
            gap: 6px;
            transition: all 0.18s ease;
        }
        .tab-btn.active {
            background-color: var(--card-bg);
            color: var(--text-color);
            box-shadow: var(--shadow-sm);
        }
        
        .tab-action { margin: 16px 0 14px; }
        .panel { display: block; }
        .panel.hidden { display: none; }

        /* Tarjetas de Tareas/Materiales (de tu 'class.html') */
        .item-card {
            background-color: var(--card-bg);
            border: 1px solid var(--border);
            border-radius: 10px;
            padding: 16px 18px;
            margin-bottom: 14px;
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            box-shadow: var(--shadow-sm);
        }
        .item-card.clickable { cursor: pointer; }
        .item-card.clickable:hover {
            box-shadow: var(--shadow-md);
            transform: translateY(-2px);
        }
        .item-main h3 {
            margin: 0 0 4px;
            font-size: 1.15rem; /* 18.4px */
            font-weight: 600;
        }
        .item-sub {
            margin: 2px 0 0;
            font-size: 0.9rem; /* 14.4px */
            color: var(--text-color-muted);
        }
        .item-file {
            margin-top: 6px;
            font-size: 0.9rem;
            color: var(--text-color-muted);
            display: inline-flex;
            align-items: center;
            gap: 4px;
        }
        .item-actions { display: flex; gap: 6px; }
        
        /* Botones de icono (de tu 'styles.css') */
        .icon-btn {
            border: none;
            background-color: var(--input-bg);
            color: var(--text-color-muted);
            border: 1px solid var(--border);
            border-radius: 10px;
            padding: 7px 10px;
            cursor: pointer;
            font-size: 14px;
            display: inline-flex !important; /* force visible despite global rules */
            align-items: center;
            transition: background 0.15s ease, transform 0.15s ease;
        }
        .icon-btn:hover {
            background-color: var(--border);
            color: var(--text-color);
            transform: translateY(-1px);
        }
        
        /* Pesta√±a Alumnos (de tu 'styles.css') */
        .students-wrapper {
            border-radius: 10px;
            padding: 18px 16px;
            border: 1px solid var(--border);
            background-color: var(--input-bg);
        }
        .students-title {
            margin: 0 0 14px;
            font-size: 1.1rem;
            font-weight: 600;
        }
        .student-row {
            background-color: var(--card-bg);
            border-radius: 8px;
            padding: 10px 12px;
            box-shadow: var(--shadow-xs);
            margin-bottom: 10px;
            border: 1px solid var(--border);
        }
        .student-name { margin: 0; font-weight: 500; font-size: 14px; }
        .student-mail { margin: 2px 0 0; font-size: 12px; color: var(--text-color-muted); }
        
        /* Modales (de tu 'styles.css' adaptados) */
        .modal-overlay {
            position: fixed;
            inset: 0;
            display: none;
            align-items: center;
            justify-content: center;
            background-color: rgba(15, 23, 42, 0.45);
            z-index: 120; /* above sidebar (100) */
            padding: 18px;
        }
        .modal-overlay.show { display: flex; }
        .modal {
            position: relative;
            width: 100%;
            max-width: 520px;
            background-color: var(--card-bg);
            padding: 24px 24px 22px;
            border-radius: 12px;
            box-shadow: 0 14px 40px rgba(15, 23, 42, 0.25);
            border: 1px solid var(--border);
        }
        .modal-title {
            margin: 0 0 4px;
            font-size: 20px;
            font-weight: 500;
        }
        .modal-subtitle {
            margin: 0 0 18px;
            font-size: 13px;
            color: var(--text-color-muted);
        }
        .modal-close {
            position: absolute;
            top: 10px;
            right: 12px;
            border: none;
            background: rgba(0,0,0,0.06);
            cursor: pointer;
            font-size: 18px;
            color: var(--text);
            width: 36px;
            height: 36px;
            border-radius: 8px;
            display: grid;
            place-items: center;
            z-index: 130;
        }
        
        /* Estilos para el visor de PDF/Imagen */
        /* Viewer: layout column, header auto-height, content grows */
        .modal-viewer {
            width: 100%;
            max-width: 1100px;
            height: 90vh;
            padding: 14px;
            display: flex;
            flex-direction: column;
            gap: 10px;
            box-sizing: border-box;
        }

        /* Allow title to wrap into multiple lines and avoid cutting it abruptly */
        .modal-viewer .modal-title {
            margin: 0;
            font-size: 18px;
            font-weight: 600;
            line-height: 1.2;
            white-space: normal;
            overflow: hidden;
            display: -webkit-box;
            -webkit-line-clamp: 3; /* show up to 3 lines (WebKit) */
            -webkit-box-orient: vertical;
            /* Standard property (future) */
            line-clamp: 3;
            /* Fallback for browsers without line-clamp support: limit height to 3 lines */
            max-height: calc(1.2em * 3);
            word-break: break-word;
        }

        /* Viewer content fills the remaining space and is scrollable when needed */
        .modal-viewer-content {
            flex: 1 1 auto;
            min-height: 0; /* allows flex child to shrink */
            margin-top: 0;
            background-color: var(--input-bg);
            border: 1px solid var(--border);
            border-radius: 8px;
            overflow: auto;
            display: flex;
            align-items: stretch;
            justify-content: center;
            padding: 8px;
        }

        /* Ensure iframe and images inside the viewer scale and fit without overflow */
        .modal-viewer-content iframe,
        .modal-viewer-content img {
            width: 100%;
            height: 100%;
            border: 0;
            object-fit: contain;
            display: block;
            max-height: 100%;
        }
        
        .hidden { display: none !important; }
        /* Download label: hidden by default, shown on small screens */
        .download-label { display: none; margin-left: 6px; font-weight: 600; }
        @media (max-width: 720px) {
            .download-label { display: inline-block; }
        }
    </style>

    <script>
      (function() { const savedTheme = localStorage.getItem('userTheme') || 'claro'; document.documentElement.setAttribute('data-theme', savedTheme); })();
    </script>
</head>
<body>

  <aside class="sidebar" id="sidebar" aria-label="Men√∫ lateral">
    <div class="brand">
      <img src="./assets/img/logo.png" alt="Logo InForest" class="logo">
      <div class="brand-name">InForest</div>
    </div>
    <nav class="menu" role="navigation" aria-label="Secciones">
      <a class="menu-item" href="plantas.html">Plantas</a>
      <a class="menu-item" href="insectos.html">Insectos</a>
      <div class="menu-sep"></div>
      <a class="menu-item" href="listas.html">Mis Listas</a>
      <a class="menu-item" href="clases.html">Clases</a>
      <a class="menu-item" href="registro-fenologico.html">Registro Fenol√≥gico</a>
      <!-- <a class="menu-item" href="comunidad.html">Foros y Ranking</a> -->
      <div class="menu-sep"></div>
      <a class="menu-item" href="perfil.html">Mi Perfil</a>
    </nav>
    <div class="sidebar-foot">
      <button id="logout" class="btn ghost btn-sm" aria-label="Salir">Salir</button>
    </div>
  </aside>

  <div class="main">
    
    <header class="topbar">
      <div class="left">
        <button id="toggleSidebar" class="icon-btn" aria-pressed="false" aria-label="Mostrar/ocultar men√∫">‚ò∞</button>
        <a id="back-to-class-btn" href="clases.html" class="btn ghost btn-sm">‚Üê Volver a Clases</a>
      </div>
      <div class="right"> 
        <div class="profile-section" id="user-profile">
          <span class="profile-name" id="username-display-topbar">Usuario</span>
          <img src="./assets/img/default-avatar.png" alt="Avatar" class="profile-avatar" id="user-avatar">
        </div>
      </div>
    </header>

    <section class="content-area">
      
      <div class="page-header">
          <div id="class-badge-code" class="badge-code">Cargando...</div>
          <h1 id="class-title" class="page-title-class">Cargando clase...</h1>
          <p id="class-professor" class="page-subtitle-class">...</p>
      </div>

      <div class="tabs">
          <button class="tab-btn active" data-tab="materiales">
              <span class="tab-icon">üìÑ</span> Materiales
          </button>
          <button class="tab-btn" data-tab="tareas">
              <span class="tab-icon">üìã</span> Tareas
          </button>
          <button class="tab-btn" data-tab="alumnos">
              <span class="tab-icon">üë•</span> Alumnos
          </button>
      </div>

      <div class="tab-action" style="display: none;">
          <button class="btn primary" id="btnSubirMaterial">Ôºã Subir Material</button>
          <button class="btn primary hidden" id="btnCrearTarea">Ôºã Crear Tarea</button>
      </div>

      <section class="panel" id="tab-materiales">
          <div id="materiales-container">
              <p>Cargando materiales...</p>
          </div>
      </section>
      <section class="panel hidden" id="tab-tareas">
          <div id="tareas-container">
              <p>Cargando tareas...</p>
          </div>
      </section>
      <section class="panel hidden" id="tab-alumnos">
          <div id="alumnos-container" class="students-wrapper">
              <p>Cargando alumnos...</p>
          </div>
      </section>
    </section>

    <footer class="foot"> <small>¬© 2025 InForest</small> </footer>
  </div>

  <div class="modal-overlay" id="overlayMaterial">
      <div class="modal-card">
          <button class="modal-close" data-close="overlayMaterial">‚úï</button>
          <h2 class="modal-title" id="material-modal-title">Subir Material</h2>
          <p class="modal-subtitle">Comparte recursos con tus alumnos.</p>
          
          <form id="material-form" novalidate>
              <div class="input-group">
                  <label for="material-titulo">T√≠tulo *</label>
                  <input type="text" id="material-titulo" class="field-input" required>
              </div>
              <div class="input-group">
                  <label for="material-descripcion">Descripci√≥n (Opcional)</label>
                  <textarea id="material-descripcion" class="field-input" rows="3"></textarea>
              </div>
              <div class="input-group">
                  <label for="material-archivo">Archivo *</label>
                  <input type="file" id="material-archivo" class="field-input" required>
                  <small id="material-file-note" class="muted" style="font-size: 0.8em; display: none; color: var(--accent);">
                      Dejar vac√≠o para conservar el archivo original.
                  </small>
              </div>
              <button type="submit" class="btn primary full" style="width: 100%; margin-top: 15px;">Guardar Material</button>
              <div id="material-message-area" class="message-area" style="margin-top: 15px;"></div>
          </form>
      </div>
  </div>
  
  <div class="modal-overlay" id="overlayTarea">
      <div class="modal-card">
          <button class="modal-close" data-close="overlayTarea">‚úï</button>
          <h2 class="modal-title" id="task-modal-title">Crear Tarea</h2>
          <p class="modal-subtitle">Asigna una tarea a tus alumnos.</p>
          
          <form id="task-form" novalidate>
              <div class="input-group">
                  <label for="task-titulo">T√≠tulo *</label>
                  <input type="text" id="task-titulo" class="field-input" required>
              </div>
              <div class="input-group">
                  <label for="task-descripcion">Descripci√≥n / Instrucciones</label>
                  <textarea id="task-descripcion" class="field-input" rows="4"></textarea>
              </div>
              <div class="input-group">
                  <label for="task-fecha">Fecha de Vencimiento</label>
                  <input type="date" id="task-fecha" class="field-input">
              </div>
              <div class="input-group">
                  <label for="task-archivo">Adjuntar Archivo</label>
                  <input type="file" id="task-archivo" class="field-input">
                  <small id="task-file-note" class="muted" style="font-size: 0.8em; display: none; color: var(--accent);">
                      Dejar vac√≠o para conservar el archivo original.
                  </small>
              </div>
              <button type="submit" class="btn primary full" style="width: 100%; margin-top: 15px;">Guardar Tarea</button>
              <div id="task-message-area" class="message-area" style="margin-top: 15px;"></div>
          </form>
      </div>
  </div>

  <div class="modal-overlay" id="material-viewer-modal">
        <div class="modal-card modal-viewer">
                <button class="modal-close" data-close="material-viewer-modal">‚úï</button>
                <h2 class="modal-title" id="viewer-modal-title">Viendo Material</h2>
                <div id="viewer-modal-content" class="modal-viewer-content">
                        </div>
        </div>
  </div>

  <script src="./assets/scripts/auth-guard.js"></script>
  
    <script src="./assets/scripts/ui-helpers.js?v=4" type="module"></script>
  <script src="./assets/scripts/api.js?v=4" type="module"></script>
  <script src="./assets/scripts/clase-detalle.js?v=4" type="module"></script> 
  </body>
</html>